# Лабораторная работа №4

**Выполнили:**
- Ступин Тимур Русланович, Группа: P3308
- Чусовлянов Максим Сергеевич, Группа: P3308

**Преподаватель:** Пенской Александр Владимирович

**Вариант:** BitTorrent Client

## Описание проекта

Реализация полнофункционального BitTorrent клиента на функциональном стеке:
- **Backend:** Clojure
- **Frontend:** ClojureScript + Reagent
- **Протокол:** BitTorrent (BEP-3)

### Основные возможности

- Парсинг `.torrent` файлов (bencode)
- Работа с UDP/HTTP tracker'ами
- Peer Wire Protocol для обмена данными
- Многопоточная загрузка с множества пиров
- End-game стратегия для эффективной докачки
- Web-интерфейс для управления торрентами
- Контроль торрентов (пауза/возобновление/удаление)

## Архитектура

### Backend (Clojure)

**Модульная структура:**
- `mini-torrent.bencode` - парсер bencode формата
- `mini-torrent.torrent` - парсинг .torrent файлов
- `mini-torrent.tracker` - работа с трекерами (UDP/HTTP)
- `mini-torrent.peer` - Peer Wire Protocol
- `mini-torrent.core` - логика загрузки и управления пирами
- `mini-torrent.session` - управление сессиями торрентов
- `mini-torrent.http-api` - REST API для фронтенда

**Ключевые алгоритмы:**
1. **Piece Selection:** Приоритетная загрузка отсутствующих кусков
2. **End-game Strategy:** Одновременный запрос последних кусков у нескольких пиров с отменой дубликатов
3. **Peer Management:** Динамическое управление пулом активных соединений

### Frontend (ClojureScript)

- **Reagent** - React-обёртка для ClojureScript
- **Tailwind CSS** - стилизация интерфейса
- **Shadow-cljs** - сборка и hot-reload

**Компоненты:**
- Список активных торрентов с прогрессом
- Детальная информация о торренте и пирах
- Форма добавления новых торрентов
- Управление статусами (downloading/paused/completed)

## Функциональные особенности

### Неизменяемость данных
Все структуры данных неизменяемы, операции модификации возвращают новые версии объектов.

### Разделение эффектов
Чистые функции отделены от побочных эффектов (I/O, сетевое взаимодействие).

### Конкурентность
Использование Clojure atoms для thread-safe управления состоянием.

## Запуск проекта

### Backend
```bash
clojure -M:run
```

### Frontend (разработка)
```bash
npm install
npx shadow-cljs watch app
```

### Сборка
```bash
npx shadow-cljs release app
```

## Тестирование

Проект включает unit-тесты для критических модулей:
```bash
clojure -M:test
```

**Покрытие:**
- Bencode encoding/decoding
- Torrent file parsing
- Peer protocol message handling
- Tracker communication

## Continuous Integration

GitHub Actions автоматически запускает:
- `clj-kondo` - статический анализ кода
- Unit-тесты backend
- Сборка frontend

## Выводы

В процессе разработки была реализована полнофункциональная система на основе принципов функционального программирования:

1. **Иммутабельность** - все операции над данными создают новые структуры
2. **Чистые функции** - разделение логики и побочных эффектов
3. **Композиция** - модульная архитектура с чёткими границами
4. **Конкурентность** - thread-safe работа через atoms и futures

Проект демонстрирует применение функциональной парадигмы для решения сложных задач сетевого программирования и многопоточной обработки данных.

